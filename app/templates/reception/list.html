{% extends "base.html" %}
{% block title %}Recepção · Pedidos{% endblock %}
{% block content %}
<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-semibold text-slate-700">Pedidos da Unidade</h1>
  <a href="{{ url_for('reception.novo_pedido') }}" class="btn-primary">Novo pedido</a>
</div>

<!-- Abas -->
<div class="border-b border-gray-200 mb-4">
  <ul class="flex flex-wrap -mb-px text-sm font-medium text-center">
    <li class="me-2">
      <button
        class="inline-block p-4 border-b-2 rounded-t-lg active-tab"
        id="tab-pedidos"
        data-tab-target="pedidos">
        Pedidos Ativos
      </button>
    </li>
    <li class="me-2">
      <button
        class="inline-block p-4 border-b-2 rounded-t-lg text-gray-500 hover:text-gray-600"
        id="tab-devolvidos"
        data-tab-target="devolvidos">
        Pedidos Devolvidos
        {% if pedidos_devolvidos|length > 0 %}
          <span class="ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800">{{ pedidos_devolvidos|length }}</span>
        {% endif %}
      </button>
    </li>
  </ul>
</div>

<!-- Conteúdo das Abas -->
<div id="tab-content">
  <!-- Abas Pedidos Ativos -->
  <div id="tab-pedidos-content" class="tab-pane block">
    <div class="bg-white rounded-lg shadow">
      <table class="min-w-full divide-y divide-slate-200">
        <thead class="bg-slate-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Paciente</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Solicitação</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Status</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Prioridade</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Criado em</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 bg-white">
          {% for pedido in pedidos %}
            <tr>
              <td class="px-4 py-3">
                <div class="text-sm font-medium text-slate-700">{{ pedido.paciente_nome }}</div>
                <div class="text-xs text-slate-500">{{ pedido.paciente_cpf }}</div>
              </td>
              <td class="px-4 py-3 text-sm text-slate-600">{{ pedido.nome_solicitacao }}</td>
              <td class="px-4 py-3">
                <span class="badge bg-sky-100 text-sky-700">{{ pedido.status }}</span>
              </td>
              <td class="px-4 py-3 text-sm text-slate-600">
                {{ pedido.prioridade or "—" }}
              </td>
              <td class="px-4 py-3 text-sm text-slate-600">
                {{ pedido.data_solicitacao.strftime("%d/%m/%Y %H:%M") if pedido.data_solicitacao }}
              </td>
              <td class="px-4 py-3 text-right">
                <a href="{{ url_for('reception.detalhes_pedido', pedido_id=pedido.id) }}" class="text-sky-600 hover:underline text-sm">Detalhes</a>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="6" class="px-4 py-6 text-center text-slate-500 text-sm">Nenhum pedido ativo.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Abas Pedidos Devolvidos -->
  <div id="tab-devolvidos-content" class="tab-pane hidden">
    <div class="bg-white rounded-lg shadow">
      <table class="min-w-full divide-y divide-slate-200">
        <thead class="bg-slate-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Paciente</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Solicitação</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Motivo da Devolução</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Prioridade</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-500 uppercase">Data</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 bg-white">
          {% for pedido in pedidos_devolvidos %}
            <tr class="hover:bg-slate-50">
              <td class="px-4 py-3">
                <div class="text-sm font-medium text-slate-700">{{ pedido.paciente_nome }}</div>
                <div class="text-xs text-slate-500">{{ pedido.paciente_cpf }}</div>
              </td>
              <td class="px-4 py-3 text-sm text-slate-600">{{ pedido.nome_solicitacao }}</td>
              <td class="px-4 py-3">
                <div class="text-sm text-slate-700">
                  {% if pedido.motivo_devolucao %}
                    <p class="whitespace-pre-wrap max-w-md">{{ pedido.motivo_devolucao }}</p>
                  {% else %}
                    <span class="text-slate-400 italic">Sem motivo registrado</span>
                  {% endif %}
                </div>
              </td>
              <td class="px-4 py-3 text-sm text-slate-600">
                {{ pedido.prioridade or "—" }}
              </td>
              <td class="px-4 py-3 text-sm text-slate-600 whitespace-nowrap">
                {{ pedido.data_solicitacao.strftime("%d/%m/%Y") if pedido.data_solicitacao }}
              </td>
              <td class="px-4 py-3 text-right">
                <a href="{{ url_for('reception.detalhes_pedido', pedido_id=pedido.id) }}" class="text-sky-600 hover:underline text-sm">Detalhes</a>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="6" class="px-4 py-6 text-center text-slate-500 text-sm">Nenhum pedido devolvido.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Script para abas -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const tabs = document.querySelectorAll("[data-tab-target]");
  const panes = document.querySelectorAll(".tab-pane");

  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      // Reset
      tabs.forEach(t => t.classList.remove("active-tab", "border-blue-500", "text-blue-600"));
      panes.forEach(p => p.classList.add("hidden"));

      // Ativa
      tab.classList.add("active-tab", "border-blue-500", "text-blue-600");
      document.getElementById(`tab-${tab.dataset.tabTarget}-content`).classList.remove("hidden");
    });
  });
});
</script>

<style>
  .active-tab {
    color: #2563eb;
    border-color: #2563eb;
  }
</style>

{% endblock %}