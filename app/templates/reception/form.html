{% extends "base.html" %}
{% block title %}Novo pedido ¬∑ Recep√ß√£o{% endblock %}
{% block content %}
<div class="bg-white rounded-lg shadow p-6">
  <h1 class="text-xl font-semibold text-slate-700 mb-4">Novo pedido</h1>

  <form method="post" class="grid grid-cols-1 md:grid-cols-2 gap-4">

    {% if not unidade_atual %}
      <div>
        <label class="block text-sm font-medium text-slate-600">Unidade de Sa√∫de</label>
        <select name="unidade_id" class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500" required>
          <option value="">Selecione</option>
          {% for unidade in unidades %}
            <option value="{{ unidade.id }}">{{ unidade.nome }}</option>
          {% endfor %}
        </select>
      </div>
    {% endif %}

    <!-- üîπ Tipo de solicita√ß√£o -->
    <div>
      <label class="block text-sm font-medium text-slate-600">Tipo de solicita√ß√£o</label>
      <select id="tipo_solicitacao" name="tipo_solicitacao" required
              class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
        <option value="exame" selected>Exame</option>
        <option value="consulta">Consulta</option>
      </select>
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-600">Nome do paciente</label>
      <input type="text" name="nome_paciente" required class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-600">CPF do paciente</label>
      <input type="text" name="cpf_paciente" maxlength="14" required class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-600">Data de nascimento</label>
      <input type="date" name="data_nascimento" class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-600">Telefone principal</label>
      <input type="text" name="telefone_principal" class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-600">Telefone secund√°rio</label>
      <input type="text" name="telefone_secundario" class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-600">E-mail</label>
      <input type="email" name="email" class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-600">Cart√£o SUS</label>
      <input type="text" name="cartao_sus" class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
    </div>

    <div class="md:col-span-2">
      <label class="block text-sm font-medium text-slate-600">Endere√ßo</label>
      <textarea name="endereco" rows="2" class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500"></textarea>
    </div>

    <!-- üîπ Campo din√¢mico: exame ou consulta -->
    <div id="campo-exame" class="md:col-span-2">
      <label class="block text-sm font-medium text-slate-600">Exame solicitado</label>
      <select name="exame_id" id="exame_id"
              class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
        <option value="">Selecione</option>
        {% for exame in exames %}
          <option value="{{ exame.id }}">{{ exame.nome }}</option>
        {% endfor %}
      </select>
    </div>

    <div id="campo-consulta" class="md:col-span-2 hidden">
      <label class="block text-sm font-medium text-slate-600">Consulta solicitada</label>
      <select name="consulta_id" id="consulta_id"
              class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500">
        <option value="">Selecione</option>
        {% for consulta in consultas %}
          <option value="{{ consulta.id }}">{{ consulta.especialidade }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="md:col-span-2">
      <label class="block text-sm font-medium text-slate-600">Observa√ß√µes adicionais</label>
      <textarea name="observacoes" rows="4" class="mt-1 block w-full rounded border-slate-300 focus:border-sky-500 focus:ring-sky-500"></textarea>
    </div>

    <div class="md:col-span-2 flex justify-end gap-3 mt-4">
      <a href="{{ url_for('reception.listar_pedidos') }}" class="btn-outline">Cancelar</a>
      <button type="submit" class="btn-primary">Salvar</button>
    </div>
  </form>
</div>

<!-- üîπ Script para alternar entre exame e consulta -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const tipoSelect = document.getElementById("tipo_solicitacao");
  const campoExame = document.getElementById("campo-exame");
  const campoConsulta = document.getElementById("campo-consulta");

  tipoSelect.addEventListener("change", () => {
    if (tipoSelect.value === "consulta") {
      campoExame.classList.add("hidden");
      campoConsulta.classList.remove("hidden");
    } else {
      campoConsulta.classList.add("hidden");
      campoExame.classList.remove("hidden");
    }
  });
});
</script>
{% endblock %}
